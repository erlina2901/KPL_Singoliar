on(e,t,n){return"function"==typeof t&&(n=t,t=!1),r.hasFileSystem()?c.checkDeletedState(this,n)?void 0:this.isWritable?this._dcxComponent||this.isExternalLink?void n(new a(a.INVALID_PARAMETER,"Cannot modify representation content once set",this._element._library.id)):void this._setComponentFromPath(e,!t,n):void n(new a(a.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id)):void n(new a(a.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._element._library.id))},i.prototype.setContentFromURL=function(e,t,n,i){if(!r.hasFileSystem()&&!e)return void i(new a(a.NOT_IMPLEMENTED,"not yet implemented setContentFromURL without a filesystem",this._element._library.id));if(!c.checkDeletedState(this,i)){if(!this.isWritable)return void i(new a(a.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id));if("boolean"!=typeof e)return void i(new a(a.INVALID_PARAMETER,"Invalid createLink parameter: must be Boolean",this._element._library.id));if(this._dcxComponent||this.isExternalLink)return void i(new a(a.INVALID_PARAMETER,"Cannot modify representation content once set",this._element._library.id));if(e)return this._dcxNode.setValue(o.LINK_TYPE_KEY,this._dcxNode.type),this._dcxNode.type=o.LINK_REPRESENTATION_TYPE,this._dcxNode.setValue(o.LINK_URL_KEY,t),this._commit(),void i(null);var s=this,u=this.element.library.collection,h=u._getTempDir();r.storageInterface.getAssetFromURL(u,t,n,h,function(e,t,n,o){if(e)return void i(d.getSyncError(e));if(!c.checkDeletedState(s,i)){var a=p.getContentTypeHeader(o&&o.headers);if(a){var u=l.getExtensions(a)[0],h=t+"."+u;r.fs.rename(t,h,function(e){return e?void i(d.getCommitError(e)):void s._setComponentFromPath(h,!1,i)})}else s._setComponentFromPath(t,!1,i)}})}},i.prototype.getContentPath=function(e){return r.hasFileSystem()?void(c.checkDeletedState(this,e)||this._getComponentPath(e)):void e(new a(a.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._element._library.id))},i.prototype.getCachedContentPath=function(){if(r.hasFileSystem()){if(this.isExternalLink){var e=this._getCachedExternalLinkPath();return e.path}return this._dcxComponent?this._getCurrentComponentPath()||void 0:void 0}},i.prototype.getContent=function(e,t){var n=r.fs,i=this;if(!c.checkDeletedState(this,t))if(r.hasFileSystem()){if(!c.checkEncoding(e,["utf8","ascii","base64","buffer"],t))return;this._getComponentPath(function(r,o){if(r||!o)return void t(r);if(!c.checkDeletedState(i,t)){var a=function(e,n){e&&d.getCommitError(e,i._element._library.id,"error reading content from disk"),t(e,n)};"buffer"===e?n.readFile(o,a):n.readFile(o,e,a)}})}else{if(!c.checkEncoding(e,["text","blob","arraybuffer"],t))return;if(!this._dcxComponent)return void t(null);var o=this._element._library._collection._syncManager;o.getSharedCloudContent(this,e,t)}},i.prototype.getContentURL=function(){if(this.isExternalLink)return this._dcxNode.getValue(o.LINK_URL_KEY);if(this._dcxComponent){var e=this._element._library._collection._syncManager;return e.getSharedCloudContentURL(this._dcxComponent)}},i.prototype.getAuthenticatedContentURL=function(e){var t=this.getContentURL(),n=this._element._library._collection._syncManager;n.appendAccessTokenToURL(t,e)},i.prototype.testExternalLink=function(e){return this.isExternalLink&&this.getContentURL()?void this._testExternalLink(!1,e):void e(new a(a.INVALID_PARAMETER,"Not an external link",this._element._library.id))},i.prototype.clearCachedExternalLink=function(){if(!this.isExternalLink||!this.getContentURL())throw new a(a.INVALID_PARAMETER,"Not an external link",this._element._library.id);if(o.SHARED_LOCAL_STORAGE)return void r.storageInterface.clearCachedExternalLink(this);var e=h.wrapCallback();f.shouldPrefetchExternalLink(this)?this._getExternalLinkPath(!0,e):this._testExternalLink(!0,e)},i.prototype.getCachedExternalLinkError=function(){if(!this.isExternalLink||!this.getContentURL())return new a(a.INVALID_PARAMETER,"Not an external link",this._element._library.id);var e=this._getCachedExternalLinkPath();return e.err},i.prototype.getExternalLinkDownloadProgress=function(){if(this.isExternalLink)return this.element.library.collection._getExternalLinkDownloadProgress(this)},Object.freeze(i),Object.seal(i.prototype),i}),define("angular-cc-libraries-api-js/components/cc-libraries-api-js/src/AdobeLibraryElementAction",["require","exports","module","./AdobeLibraryError","./utils/AdobeLibraryGeneralUtils","./AdobeLibraryConfig","./AdobeLibraryServices","./AdobeLibraryAnalytics"],function(e,t,n){"use strict";function i(e,t){this._element=e,this._id=t.action,this._appCode=t.appCode,this._appName=t.appName,this._minVersion=t.minVersion,this._installedVersions=a.ELEMENT_ACTION_PRODUCT_MAP.installedApps.filter(function(e){return e.code===t.appCode}).map(function(e){return e.version}).sort(o.compareVersions),this._invokable=this._installedVersions.length>0&&o.compareVersions(t.minVersion,this._installedVersions[0])>=0,Object.freeze(this._installedVersions)}var r=e("./AdobeLibraryError"),o=e("./utils/AdobeLibraryGeneralUtils"),a=e("./AdobeLibraryConfig"),s=e("./AdobeLibraryServices"),l=e("./AdobeLibraryAnalytics");return Object.defineProperties(i.prototype,{id:{get:function(){return this._id},set:function(e){throw new r(r.READ_ONLY,"Cannot change the id of an existing element action",this._id)}},element:{get:function(){return this._element},set:function(e){throw new r(r.READ_ONLY,"element is a read-only property",this._element.id)}},appCode:{get:function(){return this._appCode},set:function(){throw new r(r.READ_ONLY,"Cannot change the app code of an element action",this._appCode)}},appName:{get:function(){return this._appName},set:function(){throw new r(r.READ_ONLY,"Cannot change the app name of an element action",this._appName)}},minAppVersion:{get:function(){return this._minVersion},set:function(){throw new r(r.READ_ONLY,"Cannot change the min version of an element action",this._minVersion)}},installedVersions:{get:function(){return this._installedVersions},set:function(){throw new r(r.READ_ONLY,"Cannot change the installed versions of an element action")}},isCompatibleVersionInstalled:{get:function(){return!!this._invokable},set:function(){throw new r(r.READ_ONLY,"Cannot change the compatibility of an element action")}}}),i.prototype.invoke=function(e){var t=o.wrapCallback(e);return this.isCompatibleVersionInstalled?(l.reportElementActionInvoked(this),void s.storageInterface.sendElementAction(this,function(e,n){e?(e=["APP_NOT_INSTALLED","NO_COMPATIBLE_VERSION"].indexOf(e)!==-1?new r(r.NO_COMPATIBLE_APP_FOUND,"A compatible version of application is needed for this action:"+e):new r(r.APP_LAUNCH_FAILED,"Launching the app failed:"+e),l.reportElementActionFailed(this,e)):l.reportElementActionSuccessful(this,n),t(e,n)})):void t(new r(r.NO_COMPATIBLE_APP_FOUND,"A compatible version of application is needed for this action",this._appCode))},Object.freeze(i),Object.seal(i.prototype),i}),define("angular-cc-libraries-api-js/components/cc-libraries-api-js/src/utils/AdobeLibraryListenerManager",["require","exports","module","../AdobeLibraryServices","../AdobeLibraryError"],function(e,t,n){"use strict";function i(e){this._restrictedTypes=e,this._listeners={}}var r=e("../AdobeLibraryServices"),o=e("../AdobeLibraryError");return i.prototype._checkType=function(e){if(this._restrictedTypes&&this._restrictedTypes.indexOf(e)===-1){var t="["+this._restrictedTypes.join(", ")+"]";throw new o(o.INVALID_PARAMETER,e+" is not allowed. Should be one of: "+t)}},i.prototype.add=function(e,t){this._checkType(e),this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t)},i.prototype.remove=function(e,t){this._checkType(e);var n=this._listeners[e];if(n){var i=n.indexOf(t);i!==-1&&n.splice(i,1)}},i.prototype.removeAll=function(e){e?(this._checkType(e),delete this._listeners[e]):this._listeners={}},i.prototype.notify=function(e,t){this._checkType(e);var n=this._listeners[e];n&&n.slice(0).forEach(function(e){try{e.apply(void 0,t||[])}catch(e){r.log("Error in listener callback: "+(e?e.toString():"")),e&&e.stack&&r.log(e.stack)}})},i.prototype.hasListeners=function(e){this._checkType(e);var t=this._listeners[e];return!!(t&&t.length>0)},i.prototype.forEach=function(e){var t=this._listeners;Object.keys(t).forEach(function(n){t[n].forEach(function(t){e(n,t)})})},Object.freeze(i),Object.seal(i.prototype),i}),define("angular-cc-libraries-api-js/components/cc-libraries-api-js/src/AdobeLibraryElement",["require","exports","module","./AdobeLibraryServices","./AdobeLibraryConfig","./AdobeLibraryRepresentation","./AdobeLibraryAnalytics","./AdobeLibraryError","./AdobeLibraryElementAction","./utils/AdobeLibraryLock","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryRenditionUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibraryFeatureUtils","./utils/AdobeLibraryListenerManager"],function(e,t,n){"use strict";function i(e,t){this._library=e,this._renditionCache={},this._lock=new u,this._listenerManager=new m(["change"]),this._transactionCount=0,this._setDCXNode(t)}var r=e("./AdobeLibraryServices"),o=e("./AdobeLibraryConfig"),a=e("./AdobeLibraryRepresentation"),s=e("./AdobeLibraryAnalytics"),l=e("./AdobeLibraryError"),c=e("./AdobeLibraryElementAction"),u=e("./utils/AdobeLibraryLock"),d=e("./utils/AdobeLibraryManifestUtils"),p=e("./utils/AdobeLibraryFileUtils"),h=e("./utils/AdobeLibraryRenditionUtils"),f=e("./utils/AdobeLibraryErrorUtils"),g=e("./utils/AdobeLibraryFeatureUtils"),m=e("./utils/AdobeLibraryListenerManager");return i.prototype._setDCXNode=function(e,t,n){var i=this,r={};this._representations&&this._representations.forEach(function(e){r[e.id]=e}),this._dcxNode=e,this._representations=[],this._deletedLocally=!1;var o=this._library._dcxBranch.getChildrenOf(e);o.forEach(function(e){var t=r[e.id];t?(t._setDCXNode(e),delete r[e.id]):t=new a(i,e),i._representations.push(t)});var s=this._library._dcxBranch.getComponentsOf(e);s.forEach(function(e){var t=r[e.id];t?(t._setDCXComponent(e),delete r[e.id]):t=new a(i,void 0,e),i._representations.push(t)}),d.sortRepresentations(this._representations),n||this._clearRenditionCache(t,!1),this._displayName=void 0},i.prototype._markDeletedLocally=function(e){this._deletedLocally=e,this._representations.forEach(function(t){t._markDeletedLocally(e)}),e&&this._listenerManager.removeAll()},i.prototype._removeAllListeners=function(){this._listenerManager.removeAll()},i.prototype._toJSON=function(){var e={id:this.id,name:this.name,type:this.type,representations:[]};return this._representations.forEach(function(t){e.representations.push(t._toJSON())}),e.representations.sort(function(e,t){return e.type>t.type?1:e.type<t.type?-1:0}),e},i.prototype._addRepresentation=function(e,t){void 0!==t?this._representations.splice(t,0,e):this._representations.push(e)},i.prototype._removeRepresentation=function(e){var t=this._representations.indexOf(e);t!==-1&&this._representations.splice(t,1)},i.prototype._validateRelationship=function(e,t){if(o.VALID_RELATIONS.indexOf(e)===-1)throw new l(l.INVALID_PARAMETER,"Unsupported relationship",this._library.id);if(this._representations.length>0&&"primary"===e){var n=this;this._representations.forEach(function(t){if(t!==e&&"primary"===t.relationship)throw new l(l.INVALID_PARAMETER,"Cannot have more than one primary representation",n._library.id)})}},i.prototype._doCreateRepresentation=function(e,t,n){var i=this._library._dcxBranch.addChild(void 0,void 0,void 0,this._dcxNode);if(i.type=e,i.setValue(o.RELATIONSHIP_KEY,t),void 0===n){var r=this.representations[this.representations.length-1],s=Math.max(this.representations.length,r?r._getOrder()+1:0);i.setValue(o.REPRESENTATION_ORDER_KEY,s)}else i.setValue(o.REPRESENTATION_ORDER_KEY,n),this._representations.forEach(function(e,t){if(t>=n){var i=e._getDCXElement(),r=i.getValue(o.REPRESENTATION_ORDER_KEY);void 0!==r&&i.setValue(o.REPRESENTATION_ORDER_KEY,r+1)}});var l=new a(this,i);return this._addRepresentation(l,n),l},i.prototype._lookupRenditionPath=function(e){var t="existsSync",n=r.getPathSeparator(),i=this._renditionCache[e];if(i){if(i===o.RENDITION_CACHE_PLACEHOLDER||f.isErrorCode(i))return i;var a=this._library._getRenditionCacheDir()+n+i;if(o.SHARED_LOCAL_STORAGE||r.fs[t](a))return a}},i.prototype._getNewRenditionPath=function(e,t){var n=this,i=r.getPathSeparator(),o=this._library._getRenditionCacheDir();p.ensurePathExists(o,function(a){if(!d.checkDeletedState(n,t)){var s=r.uuid()+"."+(e||"png"),l=o+i+s;t(a,l,s)}})},i.prototype._getEventData=function(e,t){var n=!t&&{},i=this._dcxNode.getValue(o[e+"_DATA_KEY"])||n;if("CREATED"!==e){var r=this._dcxNode.getValue(o[e+"_KEY"]);r&&r===i.time||(i=n)}return i},i.prototype._isLocalEvent=function(e){var t=this._getEventData(e).deviceId;if(t&&o.DEVICE_ID)return t===o.DEVICE_ID},i.prototype._getEventContext=function(e){var t=JSON.parse(JSON.stringify(this._getEventData(e)));return delete t.time,delete t.deviceId,delete t.userId,t},i.prototype._clearEventData=function(e){this._dcxNode.getValue(o[e+"_DATA_KEY"])&&this._dcxNode.removeValue(o[e+"_DATA_KEY"])},i.prototype._setEventData=function(e,t){if(!o.DEVICE_ID)return void this._clearEventData(e);var n={userId:this.library.collection.userId,deviceId:o.DEVICE_ID};o.DEVICE_DESCRIPTION&&(n.device=o.DEVICE_DESCRIPTION),o.APP_DESCRIPTION&&(n.app=o.APP_DESCRIPTION),t&&(n.time=t),this._dcxNode.setValue(o[e+"_DATA_KEY"],n)},i.prototype._updateModifiedTime=function(){var e=(new Date).valueOf();this._dcxNode.setValue(o.MODIFIED_KEY,e),this._setEventData("MODIFIED",e)},i.prototype._updateCreatedTime=function(){var e=(new Date).valueOf();this._dcxNode.setValue(o.CREATED_KEY,e),this._dcxNode.setValue(o.MODIFIED_KEY,e),this._setEventData("CREATED"),this._setEventData("MODIFIED",e)},i.prototype._updateTimestampOnRemove=function(e){var t=e||(new Date).valueOf();this._dcxNode.setValue(o.REMOVED_KEY,t),this._setEventData("REMOVED",t)},i.prototype._updateTimestampOnRestore=function(){this._dcxNode.removeValue(o.REMOVED_KEY),this._clearEventData("REMOVED")},i.prototype._ensureRemovedDataValid=function(e){this.removed&&!this._getEventData("REMOVED",!0)?e?this._setEventData("REMOVED",this.removed):this._clearEventData("REMOVED"):this.removed||this._clearEventData("REMOVED");
},i.prototype._ensureModifiedDataValid=function(e){this._getEventData("MODIFIED",!0)||(e?this._setEventData("MODIFIED",this.modified):this._clearEventData("MODIFIED")),this._ensureRemovedDataValid(e)},i.prototype._ensureCreatedDataValid=function(e){e&&!this._getEventData("CREATED",!0)&&this._setEventData("CREATED"),this._ensureModifiedDataValid(e)},i.prototype._clearRenditionCache=function(e,t){var n=this,i=this._renditionCache;this._renditionCache={};var a=t&&o.SHARED_LOCAL_STORAGE&&g.supportsClearRenditionCache();Object.keys(i).forEach(function(t){!e&&!n.getRepresentationById(t)||f.isErrorCode(i[t])?a&&r.storageInterface.setRenditionCache(n,t,"CLEAR"):n._renditionCache[t]=i[t]})},i.prototype._commit=function(e){this._displayName=void 0,this._updateModifiedTime(),this._clearRenditionCache(!0,!0),this._library._commit(),this._listenerManager.notify("change"),s.reportUpdateElement(this,e)},i.prototype._commitRenditionCache=function(){this._library._commit(!0,!0),this._listenerManager.notify("change")},i.prototype._setRenditionCache=function(e,t,n){this._renditionCache[e]=t,this._commitRenditionCache(),n&&(r.storageInterface.notifyDownloadRendition(this),this._listenerManager.notify("change"))},i.prototype._wrapOperation=function(e,t){var n=this._library._wrapOperation(function(){var n=this._library._wrapOperation(e,t);return this._updateModifiedTime(),n},this);return this._listenerManager.notify("change"),n},i.prototype._getMissingLocalComponents=function(){var e=[];return this._representations.forEach(function(t){e=e.concat(t._getMissingLocalComponents())}),e},i.prototype._shouldGCLocalData=function(){var e=(new Date).valueOf();return this.removed&&e-this.removed>=o.REMOVED_ELEMENTS_CACHE_TIMEOUT},i.prototype.jasmineToString=function(){return this.toString()},Object.defineProperties(i.prototype,{id:{get:function(){return this._dcxNode.id},set:function(e){throw new l(l.READ_ONLY,"Cannot change the id of an existing element",this._library.id)}},library:{get:function(){return this._library},set:function(e){throw new l(l.READ_ONLY,"library is a read-only property",this._library.id)}},isWritable:{get:function(){return this._library.isWritable},set:function(){throw new l(l.READ_ONLY,"isWritable is a read-only property",this.id)}},name:{get:function(){return this._dcxNode.name||""},set:function(e){if(d.checkDeletedState(this),!this.isWritable)throw new l(l.NOT_ALLOWED,"you do not have write access to this library",this._library.id);this._dcxNode.name=e,this._commit(!0)}},displayName:{get:function(){return void 0===this._displayName&&(this._displayName=r.getDisplayName(this)||""),this._displayName},set:function(e){throw new l(l.READ_ONLY,"displayName is a read-only property",this._library.id)}},type:{get:function(){return this._dcxNode.type},set:function(e){throw new l(l.READ_ONLY,"Cannot change the type of an existing element",this._library.id)}},tags:{get:function(){return this._dcxNode.getValue("tags")||[]},set:function(e){if(d.checkDeletedState(this),!this.isWritable)throw new l(l.NOT_ALLOWED,"you do not have write access to this library",this._library.id);if(!e||e.constructor!==Array)throw new l(l.INVALID_PARAMETER,"tags must be an array",this._library.id);var t=e.every(function(e){return"string"==typeof e});if(!t)throw new l(l.INVALID_PARAMETER,"tags must be an array of strings",this._library.id);this._dcxNode.setValue("tags",e),this._commit()}},modified:{get:function(){return this._dcxNode.getValue(o.MODIFIED_KEY)},set:function(){throw new l(l.READ_ONLY,"Cannot change the modified timestamp of an element directly",this._library.id)}},modifiedBy:{get:function(){return this._getEventData("MODIFIED").userId},set:function(){throw new l(l.READ_ONLY,"Cannot change the modifiedBy property of an element directly",this._library.id)}},modifiedContext:{get:function(){return this._getEventContext("MODIFIED")},set:function(){throw new l(l.READ_ONLY,"Cannot change the modifiedContext property of an element directly",this._library.id)}},wasModifiedLocally:{get:function(){return this._isLocalEvent("MODIFIED")},set:function(){throw new l(l.READ_ONLY,"Cannot change the wasModifiedLocally property of an element directly",this._library.id)}},created:{get:function(){return this._dcxNode.getValue(o.CREATED_KEY)},set:function(){throw new l(l.READ_ONLY,"Cannot change the created timestamp of an element directly",this._library.id)}},createdBy:{get:function(){return this._getEventData("CREATED").userId},set:function(){throw new l(l.READ_ONLY,"Cannot change the createdBy property of an element directly",this._library.id)}},createdContext:{get:function(){return this._getEventContext("CREATED")},set:function(){throw new l(l.READ_ONLY,"Cannot change the createdContext property of an element directly",this._library.id)}},wasCreatedLocally:{get:function(){return this._isLocalEvent("CREATED")},set:function(){throw new l(l.READ_ONLY,"Cannot change the wasCreatedLocally property of an element directly",this._library.id)}},removed:{get:function(){return this._dcxNode.getValue(o.REMOVED_KEY)},set:function(){throw new l(l.READ_ONLY,"Cannot change the removed timestamp of an element directly",this._library.id)}},removedBy:{get:function(){return this._getEventData("REMOVED").userId},set:function(){throw new l(l.READ_ONLY,"Cannot change the removedBy property of an element directly",this._library.id)}},removedContext:{get:function(){return this._getEventContext("REMOVED")},set:function(){throw new l(l.READ_ONLY,"Cannot change the removedContext property of an element directly",this._library.id)}},wasRemovedLocally:{get:function(){return this._isLocalEvent("REMOVED")},set:function(){throw new l(l.READ_ONLY,"Cannot change the wasRemovedLocally property of an element directly",this._library.id)}},representations:{get:function(){return this._representations},set:function(){throw new l(l.READ_ONLY,"Cannot modify representation list directly",this._library.id)}},isDeletedLocally:{get:function(){return this._deletedLocally},set:function(){throw new l(l.READ_ONLY,"isDeletedLocally is a read-only property",this._library.id)}}}),i.prototype.toString=function(){return JSON.stringify(this._toJSON())},i.prototype.addChangeListener=function(e){d.checkDeletedState(this),this._listenerManager.add("change",e)},i.prototype.removeChangeListener=function(e){this._listenerManager.remove("change",e)},i.prototype.beginOperation=function(){if(d.checkDeletedState(this),!this.isWritable)throw new l(l.NOT_ALLOWED,"you do not have write access to this library",this.id);this._transactionCount++,this._library._beginOperation()},i.prototype.endOperation=function(e){if(d.checkDeletedState(this),!this.isWritable)throw new l(l.NOT_ALLOWED,"you do not have write access to this library",this.id);this._transactionCount>0&&(this._transactionCount--,this._library._endOperation()),e&&this._library._waitForCommit(e,!0)},i.prototype.createRepresentation=function(e,t,n,i){if(d.checkDeletedState(this),!this.isWritable)throw new l(l.NOT_ALLOWED,"you do not have write access to this library",this._library.id);return this._wrapOperation(function(){if(e===o.LINK_REPRESENTATION_TYPE)throw new l(l.INVALID_PARAMETER,"Cannot create external link representation directly - use setContentFromURL instead",this._library.id);if(void 0!==n&&(n<0||n>this._representations.length))throw new l(l.INVALID_PARAMETER,"Invalid index",this._library.id);this._validateRelationship(t);var r=this._doCreateRepresentation(e,t,n);return i||this._clearRenditionCache(!1,!0),r},this)},i.prototype.removeRepresentation=function(e){if(d.checkDeletedState(this),!this.isWritable)throw new l(l.NOT_ALLOWED,"you do not have write access to this library",this._library.id);return this._wrapOperation(function(){this._removeRepresentation(e),e._dcxComponent?this._library._dcxBranch.removeComponent(e._dcxComponent):this._library._dcxBranch.removeChild(e._dcxNode),this._clearRenditionCache(!1,!0),e._markDeletedLocally(!0)},this)},i.prototype.removeAllRepresentations=function(){if(d.checkDeletedState(this),!this.isWritable)throw new l(l.NOT_ALLOWED,"you do not have write access to this library",this._library.id);return this._wrapOperation(function(){for(;this._representations[0];)this.removeRepresentation(this._representations[0])},this)},i.prototype.getPrimaryRepresentation=function(){var e;return this._representations.forEach(function(t){e||"primary"!==t.relationship||(e=t)}),e},i.prototype.getValue=function(e,t){if(e===o.DL_NAMESPACE)throw new l(l.INVALID_PARAMETER,"Reserved namespace",this._library.id);var n=d.getDCXKey(e,t);return this._dcxNode.getValue(n)},i.prototype.getValues=function(){return d.getCustomDCXData(this._dcxNode)},i.prototype.setValue=function(e,t,n){if(d.checkDeletedState(this),!this.isWritable)throw new l(l.NOT_ALLOWED,"you do not have write access to this library",this._library.id);if(e===o.DL_NAMESPACE)throw new l(l.INVALID_PARAMETER,"Reserved namespace",this._library.id);var i,r=d.getDCXKey(e,t);try{i=JSON.parse(JSON.stringify(n))}catch(e){throw new l(l.INVALID_PARAMETER,"Value cannot be serialized to JSON",this._library.id)}this._dcxNode.setValue(r,i),this._commit()},i.prototype._getRenditionCandidate=function(e){var t,n,i,r,o,a,s,l,c=0;for(n=0;n<this._representations.length&&(i=this._representations[n],r=Math.max(i.width||0,i.height||0),o=i.isFullSize?Number.POSITIVE_INFINITY:r,a="primary"===i.relationship,s="rendition"===i.relationship,l=!t||i.isPreferredThumbnail&&!t.isPreferredThumbnail||a&&"primary"!==t.relationship||s&&"primary"!==t.relationship&&"rendition"!==t.relationship||s&&"rendition"===t.relationship&&o>c,l&&h.canComputeRendition(i)&&(t=i,c=o),!s||"image/png"!==i.type||!e||r!==e);n++);return t},i.prototype.getThumbnailURL=function(e,t){var n=this;d.checkDeletedState(this,t)||this._library._waitForCommit(function(){if(!d.checkDeletedState(n,t)){var i=n._getRenditionCandidate(e);if(i){var r=n._library._collection._syncManager;return void r.getSharedCloudRenditionUrl(i,e,t)}t(new l(l.THUMBNAIL_NOT_AVAILABLE,"no representation that can be converted into a thumbnail",n._library.id))}})},i.prototype.getThumbnailPath=function(e,t){var n=this;return r.hasFileSystem()?void(d.checkDeletedState(this,t)||this._library._waitForCommit(function(){if(!d.checkDeletedState(n,t)){if(o.SHARED_LOCAL_STORAGE)return void r.storageInterface.getRenditionPath(n,e,t);var i=function(e,i){n._lock.release(),t(e,i)};n._lock.obtain(function(){if(!d.checkDeletedState(n,i)){var t=this._lookupRenditionPath(e||"full");if(t)return void i(null,t);var o=this._getRenditionCandidate(e);if(o){if("rendition"===o.relationship&&"image/png"===o.type&&e&&Math.max(o.width||0,o.height||0)===e)return void o.getContentPath(i);var a=this._library._collection._syncManager;return void a.getSharedCloudRendition(o,e,function(t,o){if(!d.checkDeletedState(n,i))return t?void i(new l(l.THUMBNAIL_NOT_AVAILABLE,"error generating thumbnail from shared cloud",n._library.id,t)):void n._getNewRenditionPath(void 0,function(t,a,s){if(!d.checkDeletedState(n,i)){if(t)return void i(f.getCommitError(t,n._library.id,"unable to create thumbnail cache directory"));n._library._pendingRenditionCacheItems[s]=!0,r.fs.rename(o,a,function(t){if(!d.checkDeletedState(n,i)){if(t)return void i(f.getCommitError(t,n._library.id,"unable to write thumbnail to cache"));n._setRenditionCache(e||"full",s,!0),i(null,a)}})}})})}i(new l(l.THUMBNAIL_NOT_AVAILABLE,"no representation that can be converted into a thumbnail",n._library.id))}},n)}})):void t(new l(l.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._library.id))},i.prototype.setThumbnailCache=function(e,t,n){if("string"!=typeof t)return void n(new l(l.INVALID_PARAMETER,"path must be a string",this._library.id));if(!r.hasFileSystem())return void n(new l(l.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._library.id));if(!d.checkDeletedState(this,n)){if(o.SHARED_LOCAL_STORAGE)return void r.storageInterface.setRenditionCache(this,e,t,n);var i=this,a=function(e,t){i._lock.release(),n(e,t)};this._lock.obtain(function(){d.checkDeletedState(i,a)||this._getNewRenditionPath(p.getFileExtension(t),function(n,r,o){if(!d.checkDeletedState(i,a)){if(n)return void a(f.getCommitError(n,i._library.id,"unable to create thumbnail cache directory"));i._library._pendingRenditionCacheItems[o]=!0,p.copyFile(t,r,function(t){if(!d.checkDeletedState(i,a)){if(t)return void a(f.getCommitError(t,i._library.id,"unable to write thumbnail to cache"));i._setRenditionCache(e||"full",o,!1),a(null,r)}})}})},this)}},i.prototype._getActions=function(e){var t=this.getPrimaryRepresentation();if(!t)return[];var n=o.ELEMENT_ACTION_PRODUCT_MAP,i=n.types[this.type]||{},r=i[t.type]||[],a=[];r.forEach(function(t){!n.products[t]||e&&e!==n.products[t].action||a.push(new c(this,n.products[t]))}.bind(this));var s=a.map(function(e,t){return{i:t,v:e}});return s.sort(function(e,t){return e.v.isCompatibleVersionInstalled&&!t.v.isCompatibleVersionInstalled?-1:t.v.isCompatibleVersionInstalled&&!e.v.isCompatibleVersionInstalled?1:e.i-t.i}),s.map(function(e){return e.v})},i.prototype.getActions=function(e){if(!o.SHARED_LOCAL_STORAGE)throw new l(l.NOT_SUPPORTED,"getActions() not supported without shared local storage");if(e&&o.ELEMENT_ACTIONS.indexOf(e)===-1)throw new l(l.INVALID_PARAMETER,"Unknown id supplied. Potential ids are",o.ELEMENT_ACTIONS.join(", "));return this._getActions(e)},i.prototype.getReference=function(){return"cloud-asset://"+this._library._collection._syncManager.getElementRefDomain()+this._library._collection._syncManager.getElementRefPath()+"/"+this._library.id+";node="+this.id},i.prototype.getRepresentationById=function(e){var t;return this.representations.forEach(function(n){n.id===e&&(t=n)}),t},Object.freeze(i),Object.seal(i.prototype),i}),define("angular-cc-libraries-api-js/components/cc-libraries-api-js/src/AdobeLibraryFolder",["require","exports","module","./components/dcx-js/src/AdobeDCXError","./AdobeLibraryElement","./AdobeLibraryConfig","./AdobeLibraryAnalytics","./AdobeLibraryError","./AdobeLibraryServices","./AdobeLibraryLocalisation","./utils/AdobeLibraryAsyncJoin","./utils/AdobeLibraryLock","./utils/AdobeLibraryRenditionUtils","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryGeneralUtils","./utils/AdobeLibraryMimeTypeUtils","./utils/AdobeLibraryListenerManager"],function(e,t,n){"use strict";function i(e,t){this._collection=e,this._dcxComposite=t,this._dcxBranch=t.current,this._listenerManager=new y(["change"]),this._writable=!0,this._filterCache={},this._transactionCount=0,this._commitInProgress=!1,this._pendingCommit=!1,this._onCommitCallbacks=[],this._dcxLock=new p,this._renditionCacheLock=new p,this._pendingRenditionCacheItems={},this._networkLock=new p,this._syncState=void 0,this._deletedLocally=!1,this._deletedFromServer=!1,this._waitForSyncToFinishCallbacks=[],this._errors=[],this._pushFailedDueToQuota=!1,this._numUpdateConflicts=0;var n=this._dcxBranch.getChildrenOf();n.forEach(function(e){e.name===a.ELEMENTS_NAME&&(this._dcxElementsNode=e),e.name===a.REMOVED_ELEMENTS_NAME&&(this._dcxRemovedElementsNode=e)},this),this._dcxElementsNode||(this._dcxElementsNode=this._dcxBranch.addChild(a.ELEMENTS_NAME)),this._dcxCompositeRenditionMap=f.getCompositeRenditionMap(this._dcxBranch),this._elements=[],this._removedElements=[];var i=this._dcxBranch.getChildrenOf(this._dcxElementsNode);if(i.forEach(function(e){var t=new o(this,e);this._addElementToFilter(t),this._elements.push(t)},this),this._dcxRemovedElementsNode){var r=this._dcxBranch.getChildrenOf(this._dcxRemovedElementsNode);r.forEach(function(e){var t=new o(this,e);this._removedElements.push(t)},this),this._sortRemovedElements()}c.hasFileSystem()||(this._dcxBaseBranch=this._dcxBranch.copy())}var r=e("./components/dcx-js/src/AdobeDCXError"),o=e("./AdobeLibraryElement"),a=e("./AdobeLibraryConfig"),s=e("./AdobeLibraryAnalytics"),l=e("./AdobeLibraryError"),c=e("./AdobeLibraryServices"),u=e("./AdobeLibraryLocalisation"),d=e("./utils/AdobeLibraryAsyncJoin"),p=e("./utils/AdobeLibraryLock"),h=e("./utils/AdobeLibraryRenditionUtils"),f=e("./utils/AdobeLibraryManifestUtils"),g=e("./utils/AdobeLibraryErrorUtils"),m=e("./utils/AdobeLibraryFileUtils"),v=e("./utils/AdobeLibraryGeneralUtils"),_=e("./utils/AdobeLibraryMimeTypeUtils"),y=e("./utils/AdobeLibraryListenerManager");return i.prototype._getRemovedElementsNode=function(){return this._dcxRemovedElementsNode||(this._dcxRemovedElementsNode=this._dcxBranch.addChild(a.REMOVED_ELEMENTS_NAME)),this._dcxRemovedElementsNode},i.prototype._markDeletedLocally=function(e){this._deletedLocally=e,this._elements.forEach(function(t){t._markDeletedLocally(e)}),e&&this._listenerManager.removeAll()},i.prototype._removeAllListeners=function(){this._listenerManager.removeAll(),this._elements.forEach(function(e){e._removeAllListeners()})},i.prototype._toJSON=function(){var e={id:this.id,name:this.name,elements:[],renditionCache:{}};return this._elements.forEach(function(t){e.elements.push(t._toJSON()),e.renditionCache[t.id]=JSON.parse(JSON.stringify(t._renditionCache))}),e},i.prototype._getRenditionCache=function(){var e={},t=function(t){e[t.id]=JSON.parse(JSON.stringify(t._renditionCache))};return this._elements.forEach(t),this._removedElements.forEach(t),e},i.prototype._setRenditionCache=function(e){var t=function(t){e[t.id]&&(t._renditionCache=e[t.id])};this._elements.forEach(t),this._removedElements.forEach(t)},i.prototype._loadRenditionCache=function(e){var t=this;h.readRenditionCacheData(this,function(n,i){!n&&i&&t._setRenditionCache(i.renditions),e(null)})},i.prototype._saveRenditionCache=function(e){var t=this;if(!c.hasFileSystem()||a.SHARED_LOCAL_STORAGE)return void(e&&e(null));var n=function(n){t._renditionCacheLock.release(),e&&e(n)};this._renditionCacheLock.obtain(function(){var e={};e.renditions=this._getRenditionCache(),h.writeRenditionCacheData(this,e,n)},this)},i.prototype._doCommit=function(e){function t(){if(e&&!a.SHARED_LOCAL_STORAGE){if(r._deletedLocally)return;r._collection._clearSyncErrors(),r._push(),r._collection._resetPollBackoff()}}function n(e){var n=r._onCommitCallbacks;r._onCommitCallbacks=[],n.forEach(function(t){t.waitForSuccess&&!e?r._onCommitCallbacks.push(t):r._waitForCommit(t.callback)}),t()}function i(e,t){e&&(e=g.getCommitError(e,r.id,t)),r._collection._reportCommitError(e)}var r=this;return c.hasFileSystem()?this._commitInProgress?void(this._pendingCommit=!0):(this._commitInProgress=!0,void c.storageInterface.commitManifest(this,function(t,o){i(t,"Failed to write composite to disk"),r._saveRenditionCache(function(t){i(t,"Failed to write rendition cache to disk"),r._commitInProgress=!1,r._pendingCommit?(r._pendingCommit=!1,0===r._transactionCount&&r._doCommit(e)):n(o)})})):void n()},i.prototype._waitForCommit=function(e,t){this._commitInProgress||this._transactionCount>0?this._onCommitCallbacks.push({callback:e,waitForSuccess:t}):e()},i.prototype._notifyChange=function(){this._listenerManager.notify("change"),this._collection._notifyChange()},i.prototype._commit=function(e,t){0===this._transactionCount&&(t||(this._updateModifiedTime(),this._notifyChange()),this._doCommit(!e))},i.prototype._wrapOperation=function(e,t){this._beginOperation();var n;try{n=e.call(t)}catch(e){throw this._transactionCount--,e}return this._endOperation(),n},i.prototype._beginOperation=function(){this._transactionCount++},i.prototype._endOperation=function(){this._transactionCount--,this._commit()},i.prototype._updateModifiedTime=function(){var e=(new Date).valueOf();this._dcxBranch.rootNode.setValue(a.MODIFIED_KEY,e)},i.prototype._updateCreatedTime=function(){var e=(new Date).valueOf();this._dcxBranch.rootNode.setValue(a.CREATED_KEY,e),this._dcxBranch.rootNode.setValue(a.MODIFIED_KEY,e)},i.prototype._getMissingLocalComponents=function(){var e=[];return this._elements.forEach(function(t){e=e.concat(t._getMissingLocalComponents())}),e},i.prototype._gcLocalData=function(e){var t=[],n=[];return this._removedElements.forEach(function(e){e._shouldGCLocalData()&&(t.push(e),e.representations.forEach(function(e){var t=e._dcxComponent,i=e._getCurrentComponentPath();t&&i&&t.etag&&"modified"!==t.state&&n.push(t.id)}))}),0===t.length?void e(null):(t.forEach(function(e){e._renditionCache={}}),void this._dcxComposite.removeLocalFilesForComponentsWithIDs(n,e))},i.prototype._checkRenditionType=function(e,t){if(!e||a.VALID_LIBRARY_RENDITION_TYPES.indexOf(e)===-1){if(t)return t(new l(l.INVALID_PARAMETER,"composite rendition type not supported: "+e)),!1;throw new l(l.INVALID_PARAMETER,"composite rendition type not supported: "+e)}return!0},i.prototype._setRenditionFromPath=function(e,t,n,i){if(!f.checkDeletedState(this,i)){var r=this._dcxCompositeRenditionMap[e],o=this,s=t&&c.getFileNameFromPath(t),l=m.getFileExtension(s),u=c.uuid()+"."+l;m.checkFileSize(t,function(l){return l?void i(l):void c.storageInterface.notifyStartWrite(o,[],function(){o._dcxBranch.addComponent(s,n,"rendition",u,t,!0,void 0,o._dcxBranch.rootNode,void 0,function(t,n){return t?void i(t):void(f.checkDeletedState(o,i)||(n.setValue(a.MODIFIED_KEY,(new Date).valueOf()),n.setValue(a.RENDITION_TYPE_KEY,e),r&&o._dcxBranch.removeComponent(r),o._dcxCompositeRenditionMap=f.getCompositeRenditionMap(o._dcxBranch),o._commit(),i(null)))})})})}},i.prototype._setRendition=function(e,t,n,i,r){function o(t){return t?void r(g.getCommitError(t,u.id,"error writing library rendition")):void(f.checkDeletedState(u,r)||u._setRenditionFromPath(e,s,i,r))}function a(){"buffer"===n?l.writeFile(s,t,o):l.writeFile(s,t,n,o)}var s,l=c.fs,u=this,d=this.collection._getTempDir();m.ensurePathExists(d,function(e){if(e)return void r(g.getCommitError(e,u.id,"error creating temp directory"));if(!f.checkDeletedState(u,r)){var t=_.getExtensions(i)[0],n=c.uuid()+"."+t;s=d+c.getPathSeparator()+n,a()}})},i.prototype._setRenditionInBrowser=function(e,t,n,i){var r=this,o=this._dcxCompositeRenditionMap[e],s=this._collection._syncManager,l=c.uuid();s.uploadNewComponentForLibrary(t,l,n,"rendition",this,function(t,n){return t?void i(t):void(f.checkDeletedState(r,i)||(n.setValue(a.MODIFIED_KEY,(new Date).valueOf()),n.setValue(a.RENDITION_TYPE_KEY,e),o&&r._dcxBranch.removeComponent(o),r._dcxCompositeRenditionMap=f.getCompositeRenditionMap(r._dcxBranch),r._commit(),i(null)))})},i.prototype._getFilterKey=function(e){var t=e&&a.ELEMENT_TYPE_FILTERS.indexOf(e)!==-1;return t?e:"*"},i.prototype._removeElementFromFilter=function(e){var t=this._getFilterKey(e.type);if(this._filterCache[t]){var n=this._filterCache[t].indexOf(e);n!==-1&&this._filterCache[t].splice(n,1)}},i.prototype._addElementToFilter=function(e){var t=this._getFilterKey(e.type);this._filterCache[t]=this._filterCache[t]||[],this._filterCache[t].push(e)},i.prototype._doCreateElement=function(e,t){var n=this._dcxBranch.addChild(e,void 0,void 0,this._dcxElementsNode);n.path=n.id,n.type=t;var i=new o(this,n);return i._updateCreatedTime(),this._elements.push(i),this._addElementToFilter